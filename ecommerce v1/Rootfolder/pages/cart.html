<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout | ShopEasy</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="../images/logo.png">
    <style>
        /* Checkout Page Styles */
        .checkout-page {
            padding: 40px 0 80px;
        }
        
        .checkout-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 40px;
        }
        
        .checkout-section {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .checkout-section h2 {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-gray);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkout-section h2 i {
            color: var(--primary-color);
        }
        
        /* Form Styles */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        .form-group.required label::after {
            content: " *";
            color: var(--danger-color);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .form-control.error {
            border-color: var(--danger-color);
        }
        
        .form-error {
            color: var(--danger-color);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        /* Shipping Methods - Fixed Visibility */
        .shipping-methods {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .shipping-method {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid var(--light-gray);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background-color: white;
        }
        
        .shipping-method:hover {
            border-color: var(--primary-color-light);
            background-color: var(--light-gray);
        }
        
        .shipping-method.selected {
            border-color: var(--primary-color);
            background-color: rgba(0, 123, 255, 0.1);
        }
        
        .shipping-method input[type="radio"] {
            margin-right: 15px;
            transform: scale(1.2);
            accent-color: var(--primary-color);
            width: 18px;
            height: 18px;
        }
        
        .shipping-method-details {
            flex-grow: 1;
        }
        
        .shipping-method-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--dark-color);
        }
        
        .shipping-method-description {
            font-size: 14px;
            color: var(--gray-color);
            margin-bottom: 5px;
        }
        
        .shipping-method-price {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 18px;
        }
        
        /* Payment Methods - FIXED VISIBILITY */
        .payment-methods {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .payment-method {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid var(--light-gray);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background-color: white;
        }
        
        .payment-method:hover {
            border-color: var(--primary-color-light);
            background-color: var(--light-gray);
        }
        
        .payment-method.selected {
            border-color: var(--primary-color);
            background-color: rgba(0, 123, 255, 0.1);
        }
        
        .payment-method input[type="radio"] {
            margin-right: 15px;
            transform: scale(1.2);
            accent-color: var(--primary-color);
            width: 18px;
            height: 18px;
        }
        
        .payment-method-details {
            flex-grow: 1;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .payment-method-icon {
            width: 40px;
            height: 40px;
            background-color: var(--light-gray);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark-color);
            font-size: 20px;
        }
        
        .payment-method-info {
            flex-grow: 1;
        }
        
        .payment-method-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--dark-color);
            font-size: 16px;
        }
        
        .payment-method-description {
            font-size: 14px;
            color: var(--gray-color);
        }
        
        .card-icons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .card-icon {
            width: 40px;
            height: 25px;
            background-color: white;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: var(--dark-color);
            border: 1px solid #ddd;
        }
        
        .payment-form {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background-color: var(--light-gray);
            border-radius: var(--border-radius);
            animation: slideDown 0.3s ease;
        }
        
        .payment-form.active {
            display: block;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Order Summary */
        .order-summary-checkout {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            position: sticky;
            top: 100px;
        }
        
        .order-summary-checkout h2 {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-gray);
        }
        
        .order-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .order-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .order-item:last-child {
            border-bottom: none;
        }
        
        .order-item-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: var(--border-radius);
            margin-right: 15px;
        }
        
        .order-item-details {
            flex-grow: 1;
        }
        
        .order-item-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
            color: var(--dark-color);
        }
        
        .order-item-quantity {
            font-size: 12px;
            color: var(--gray-color);
        }
        
        .order-item-price {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .summary-details-checkout {
            margin: 20px 0;
            padding: 20px 0;
            border-top: 2px solid var(--light-gray);
            border-bottom: 2px solid var(--light-gray);
        }
        
        .summary-row-checkout {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            color: var(--dark-color);
        }
        
        .summary-row-checkout.total {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-color);
            margin-top: 15px;
        }
        
        .coupon-section {
            margin-bottom: 20px;
        }
        
        .coupon-input {
            display: flex;
            gap: 10px;
        }
        
        .coupon-input input {
            flex-grow: 1;
        }
        
        .btn-apply-coupon {
            white-space: nowrap;
        }
        
        .terms-check {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .terms-check input {
            margin-top: 3px;
        }
        
        .terms-check a {
            color: var(--primary-color);
            text-decoration: underline;
        }
        
        .checkout-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }
        
        .secure-checkout-checkout {
            text-align: center;
            margin-top: 20px;
            color: var(--gray-color);
        }
        
        .secure-checkout-checkout i {
            font-size: 40px;
            color: var(--success-color);
            margin-bottom: 10px;
        }
        
        @media (max-width: 992px) {
            .checkout-container {
                grid-template-columns: 1fr;
            }
            
            .order-summary-checkout {
                position: static;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 0;
            }
        }

        /* Celebration Popup Styles */
.celebration-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    animation: fadeIn 0.3s ease;
}

.celebration-popup.active {
    display: flex;
}

.popup-content {
    background: white;
    border-radius: 20px;
    padding: 40px;
    text-align: center;
    max-width: 500px;
    width: 90%;
    position: relative;
    animation: popIn 0.5s ease;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

.popup-content h2 {
    color: var(--success-color);
    font-size: 32px;
    margin-bottom: 20px;
}

.popup-content p {
    color: var(--gray-color);
    font-size: 18px;
    margin-bottom: 30px;
    line-height: 1.6;
}

.success-icon {
    font-size: 80px;
    color: var(--success-color);
    margin-bottom: 20px;
    animation: bounce 1s ease infinite;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-20px); }
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes popIn {
    0% {
        opacity: 0;
        transform: scale(0.8);
    }
    70% {
        transform: scale(1.05);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

.btn-close-popup {
    background-color: var(--primary-color);
    color: white;
    border: none;
    padding: 12px 30px;
    border-radius: var(--border-radius);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-close-popup:hover {
    background-color: var(--primary-color-dark);
    transform: translateY(-2px);
    color:white;
    background-color: green;
}

/* Confetti Animation */
.confetti {
    position: absolute;
    width: 10px;
    height: 10px;
    opacity: 0;
    animation: confettiFall 3s ease-out forwards;
}

@keyframes confettiFall {
    0% {
        opacity: 1;
        transform: translateY(-100vh) rotate(0deg);
    }
    100% {
        opacity: 0;
        transform: translateY(100vh) rotate(720deg);
    }
}

/* Form Error Styling */
.form-control.error {
    border-color: var(--danger-color) !important;
    background-color: rgba(220, 53, 69, 0.05);
}

.form-error {
    color: var(--danger-color);
    font-size: 14px;
    margin-top: 5px;
    display: none;
    animation: fadeIn 0.3s ease;
}

/* Required field indicator */
.form-group.required label::after {
    content: " *";
    color: var(--danger-color);
}

/* Add some animation for error display */
@keyframes shake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
    20%, 40%, 60%, 80% { transform: translateX(5px); }
}

.form-control.error {
    animation: shake 0.5s ease;
}

/* Country-State-City Dropdown Styling */
select.form-control {
    appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 15px center;
    background-size: 16px;
    padding-right: 40px;
}

select.form-control:disabled {
    background-color: var(--light-gray);
    color: var(--gray-color);
    cursor: not-allowed;
}

/* Loading indicator for dropdowns */
.dropdown-loading {
    position: relative;
}

.dropdown-loading::after {
    content: '';
    position: absolute;
    right: 40px;
    top: 50%;
    transform: translateY(-50%);
    width: 16px;
    height: 16px;
    border: 2px solid var(--light-gray);
    border-top-color: var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: translateY(-50%) rotate(360deg); }
}

/* Country flag emoji */
.country-option {
    display: flex;
    align-items: center;
    gap: 10px;
}

.country-flag {
    font-size: 20px;
}
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <p>Loading Checkout...</p>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <a href="../index.html" class="logo">
                    <i class="fas fa-shopping-bag"></i>
                    <span>ShopEasy</span>
                </a>

                <div class="search-container">
                    <div class="category-dropdown">
                        <button class="category-toggle">
                            All Categories <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="category-menu">
                            <a href="categories.html?cat=electronics"><i class="fas fa-laptop"></i> Electronics</a>
                            <a href="categories.html?cat=fashion"><i class="fas fa-tshirt"></i> Fashion</a>
                            <a href="categories.html?cat=home"><i class="fas fa-home"></i> Home & Kitchen</a>
                            <a href="categories.html?cat=beauty"><i class="fas fa-spa"></i> Beauty</a>
                            <a href="categories.html?cat=sports"><i class="fas fa-basketball-ball"></i> Sports</a>
                        </div>
                    </div>
                    <input type="text" class="search-input" placeholder="Search for products...">
                    <button class="search-btn"><i class="fas fa-search"></i></button>
                </div>

                <div class="nav-actions">
                    <div class="nav-action" id="accountLink">
                        <a href="login.html" class="nav-icon">
                            <i class="fas fa-user"></i>
                            <span>Login</span>
                        </a>
                    </div>
                    <div class="nav-action">
                        <a href="wishlist.html" class="nav-icon">
                            <i class="fas fa-heart"></i>
                            <span>Wishlist</span>
                            <span class="badge" id="wishlistCount">0</span>
                        </a>
                    </div>
                    <div class="nav-action">
                        <a href="cart.html" class="nav-icon">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Cart</span>
                            <span class="badge" id="cartCount">0</span>
                        </a>
                    </div>
                </div>

                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </nav>
        </div>

        <!-- Mobile Menu -->
        <div class="mobile-menu" id="mobileMenu">
            <div class="mobile-menu-header">
                <h3>ShopEasy Menu</h3>
                <button class="mobile-menu-close" id="mobileMenuClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mobile-search">
                <input type="text" placeholder="Search products...">
                <button><i class="fas fa-search"></i></button>
            </div>
            
            <div class="mobile-menu-links">
                <a href="../index.html"><i class="fas fa-home"></i> Home</a>
                <a href="products.html"><i class="fas fa-th-large"></i> All Products</a>
                <a href="categories.html"><i class="fas fa-list"></i> Categories</a>
                <a href="wishlist.html"><i class="fas fa-heart"></i> Wishlist</a>
                <a href="cart.html"><i class="fas fa-shopping-cart"></i> Cart</a>
                <a href="login.html"><i class="fas fa-user"></i> Account</a>
                <a href="about.html"><i class="fas fa-info-circle"></i> About Us</a>
                <a href="contact.html"><i class="fas fa-phone"></i> Contact</a>
                <a href="faq.html"><i class="fas fa-question-circle"></i> FAQ</a>
            </div>
            
            <div class="mobile-menu-footer">
                <p>© 2024 ShopEasy. All rights reserved.</p>
            </div>
        </div>

        <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>
    </header>

    <!-- Breadcrumb -->
    <section class="breadcrumb">
        <div class="container">
            <a href="../index.html">Home</a> / <a href="cart.html">Cart</a> / <span>Checkout</span>
        </div>
    </section>

    <!-- Checkout Page Content -->
    <main class="checkout-page">
        <div class="container">
            <div class="page-header">
                <h1>Checkout</h1>
                <p>Complete your purchase securely</p>
            </div>

            <div class="checkout-container">
                <!-- Checkout Form -->
                <div class="checkout-form">
                    <!-- Contact Information -->
                    <div class="checkout-section">
                        <h2><i class="fas fa-user"></i> Contact Information</h2>
                        <div class="form-row">
                            <div class="form-group required">
                                <label for="firstName">First Name</label>
                                <input type="text" id="firstName" class="form-control" placeholder="John">
                            </div>
                            <div class="form-group required">
                                <label for="lastName">Last Name</label>
                                <input type="text" id="lastName" class="form-control" placeholder="Doe">
                            </div>
                        </div>
                        <div class="form-group required">
                            <label for="email">Email Address</label>
                            <input type="email" id="email" class="form-control" placeholder="john@example.com">
                        </div>
                        <div class="form-group required">
                            <label for="phone">Phone Number</label>
                            <input type="tel" id="phone" class="form-control" placeholder="+1 (555) 123-4567">
                        </div>
                    </div>

                    <!-- Shipping Address -->
<div class="checkout-section">
    <h2><i class="fas fa-map-marker-alt"></i> Shipping Address</h2>
    <div class="form-group required">
        <label for="address">Street Address</label>
        <input type="text" id="address" class="form-control" placeholder="123 Main Street">
    </div>
    <div class="form-row">
        <div class="form-group required">
            <label for="country">Country</label>
            <select id="country" class="form-control" onchange="updateStates()">
                <option value="">Select Country</option>
                <option value="US">United States</option>
                <option value="IN">India</option>
                <option value="CA">Canada</option>
                <option value="UK">United Kingdom</option>
                <option value="AU">Australia</option>
                <option value="DE">Germany</option>
                <option value="FR">France</option>
                <option value="JP">Japan</option>
            </select>
        </div>
        <div class="form-group required">
            <label for="state">State/Province</label>
            <select id="state" class="form-control" onchange="updateCities()" disabled>
                <option value="">Select State</option>
                <!-- States will be populated dynamically -->
            </select>
        </div>
    </div>
    <div class="form-row">
        <div class="form-group required">
            <label for="city">City</label>
            <select id="city" class="form-control" disabled>
                <option value="">Select City</option>
                <!-- Cities will be populated dynamically -->
            </select>
        </div>
        <div class="form-group required">
            <label for="zipCode">ZIP/Postal Code</label>
            <input type="text" id="zipCode" class="form-control" placeholder="10001 or 560001">
        </div>
    </div>
    <div class="form-group">
        <label class="checkbox-label">
            <input type="checkbox" id="saveAddress"> Save this address for future orders
        </label>
    </div>
</div>

                    <!-- Shipping Method - FIXED -->
                    <div class="checkout-section">
                        <h2><i class="fas fa-shipping-fast"></i> Shipping Method</h2>
                        <div class="shipping-methods">
                            <div class="shipping-method selected" data-method="standard">
                                <input type="radio" name="shipping" id="standard-shipping" checked>
                                <div class="shipping-method-details">
                                    <div class="shipping-method-name">Standard Shipping</div>
                                    <div class="shipping-method-description">5-7 business days</div>
                                    <div class="shipping-method-price">$9.99</div>
                                </div>
                            </div>
                            <div class="shipping-method" data-method="express">
                                <input type="radio" name="shipping" id="express-shipping">
                                <div class="shipping-method-details">
                                    <div class="shipping-method-name">Express Shipping</div>
                                    <div class="shipping-method-description">2-3 business days</div>
                                    <div class="shipping-method-price">$19.99</div>
                                </div>
                            </div>
                            <div class="shipping-method" data-method="overnight">
                                <input type="radio" name="shipping" id="overnight-shipping">
                                <div class="shipping-method-details">
                                    <div class="shipping-method-name">Overnight Shipping</div>
                                    <div class="shipping-method-description">Next business day</div>
                                    <div class="shipping-method-price">$29.99</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Method - FIXED VISIBILITY -->
                    <div class="checkout-section">
                        <h2><i class="fas fa-credit-card"></i> Payment Method</h2>
                        <div class="payment-methods">
                            <!-- Credit Card Option -->
                            <div class="payment-method selected" data-method="credit-card">
                                <input type="radio" name="payment" id="credit-card" checked>
                                <div class="payment-method-details">
                                    <div class="payment-method-icon">
                                        <i class="far fa-credit-card"></i>
                                    </div>
                                    <div class="payment-method-info">
                                        <div class="payment-method-name">Credit/Debit Card</div>
                                        <div class="payment-method-description">Pay with Visa, Mastercard, or American Express</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Credit Card Form -->
                            <div class="payment-form active" id="credit-card-form">
                                <div class="card-icons">
                                    <div class="card-icon">VISA</div>
                                    <div class="card-icon">MC</div>
                                    <div class="card-icon">AMEX</div>
                                </div>
                                <div class="form-group required">
                                    <label for="card-number">Card Number</label>
                                    <input type="text" id="card-number" class="form-control" placeholder="1234 5678 9012 3456" maxlength="19">
                                </div>
                                <div class="form-group required">
                                    <label for="card-name">Name on Card</label>
                                    <input type="text" id="card-name" class="form-control" placeholder="John Doe">
                                </div>
                                <div class="form-row">
                                    <div class="form-group required">
                                        <label for="expiry-date">Expiry Date</label>
                                        <input type="text" id="expiry-date" class="form-control" placeholder="MM/YY" maxlength="5">
                                    </div>
                                    <div class="form-group required">
                                        <label for="cvv">CVV</label>
                                        <input type="password" id="cvv" class="form-control" placeholder="123" maxlength="4">
                                    </div>
                                </div>
                            </div>

                            <!-- PayPal Option -->
                            <div class="payment-method" data-method="paypal">
                                <input type="radio" name="payment" id="paypal">
                                <div class="payment-method-details">
                                    <div class="payment-method-icon" style="background-color: #003087; color: white;">
                                        <i class="fab fa-paypal"></i>
                                    </div>
                                    <div class="payment-method-info">
                                        <div class="payment-method-name">PayPal</div>
                                        <div class="payment-method-description">Pay securely with your PayPal account</div>
                                    </div>
                                </div>
                            </div>

                            <!-- PayPal Form -->
                            <div class="payment-form" id="paypal-form">
                                <div class="paypal-info">
                                    <p>You will be redirected to PayPal to complete your payment securely.</p>
                                    <button type="button" class="btn btn-primary" id="paypal-redirect">
                                        <i class="fab fa-paypal"></i> Continue with PayPal
                                    </button>
                                </div>
                            </div>

                            <!-- Apple Pay Option -->
                            <div class="payment-method" data-method="apple-pay">
                                <input type="radio" name="payment" id="apple-pay">
                                <div class="payment-method-details">
                                    <div class="payment-method-icon" style="background-color: #000; color: white;">
                                        <i class="fab fa-apple"></i>
                                    </div>
                                    <div class="payment-method-info">
                                        <div class="payment-method-name">Apple Pay</div>
                                        <div class="payment-method-description">Pay with Apple Pay</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Google Pay Option -->
                            <div class="payment-method" data-method="google-pay">
                                <input type="radio" name="payment" id="google-pay">
                                <div class="payment-method-details">
                                    <div class="payment-method-icon" style="background-color: #4285F4; color: white;">
                                        <i class="fab fa-google"></i>
                                    </div>
                                    <div class="payment-method-info">
                                        <div class="payment-method-name">Google Pay</div>
                                        <div class="payment-method-description">Pay with Google Pay</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Order Notes -->
                    <div class="checkout-section">
                        <h2><i class="fas fa-edit"></i> Order Notes (Optional)</h2>
                        <div class="form-group">
                            <label for="orderNotes">Special instructions for your order</label>
                            <textarea id="orderNotes" class="form-control" rows="4" placeholder="e.g., Leave package at the front door, special delivery instructions, etc."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Order Summary -->
                <div class="order-summary-checkout">
                    <h2>Order Summary</h2>
                    <div class="order-items" id="orderItems">
                        <!-- Order items will be loaded via JavaScript -->
                    </div>
                    <div class="summary-details-checkout">
                        <div class="summary-row-checkout">
                            <span>Subtotal</span>
                            <span id="checkoutSubtotal">$0.00</span>
                        </div>
                        <div class="summary-row-checkout">
                            <span>Shipping</span>
                            <span id="checkoutShipping">$9.99</span>
                        </div>
                        <div class="summary-row-checkout">
                            <span>Tax</span>
                            <span id="checkoutTax">$0.00</span>
                        </div>
                        <div class="summary-row-checkout total">
                            <span>Total</span>
                            <span id="checkoutTotal">$0.00</span>
                        </div>
                    </div>
                    
                    <!-- Coupon Section -->
                    <div class="coupon-section">
                        <label for="couponCode">Have a coupon code?</label>
                        <div class="coupon-input">
                            <input type="text" id="couponCode" class="form-control" placeholder="Enter coupon code">
                            <button class="btn btn-outline btn-apply-coupon">Apply</button>
                        </div>
                    </div>
                    
                    <!-- Terms and Conditions -->
                    <div class="terms-check">
                        <input type="checkbox" id="agreeTerms" required>
                        <label for="agreeTerms">
                            I agree to the <a href="#">Terms & Conditions</a> and <a href="#">Privacy Policy</a>. I understand that my order is non-refundable and subject to availability.
                        </label>
                    </div>
                    
                    <!-- Checkout Button -->
                    <button class="btn btn-primary btn-lg" id="placeOrderBtn" style="width: 100%;">
                        <i class="fas fa-lock"></i> Place Order
                    </button>
                    
                    <!-- Secure Checkout -->
                    <div class="secure-checkout-checkout">
                        <i class="fas fa-shield-alt"></i>
                        <p>Secure Checkout • SSL Encrypted</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <a href="../index.html" class="footer-logo">
                        <i class="fas fa-shopping-bag"></i>
                        <span>ShopEasy</span>
                    </a>
                    <p>Your one-stop destination for premium shopping experience. Quality products at affordable prices.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="../index.html">Home</a></li>
                        <li><a href="products.html">Products</a></li>
                        <li><a href="categories.html">Categories</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h3>Customer Service</h3>
                    <ul>
                        <li><a href="faq.html">FAQ</a></li>
                        <li><a href="#">Shipping Policy</a></li>
                        <li><a href="#">Returns & Refunds</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms & Conditions</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h3>Contact Info</h3>
                    <ul class="contact-info">
                        <li><i class="fas fa-map-marker-alt"></i> 123 Street, City, Country</li>
                        <li><i class="fas fa-phone"></i> +1 234 567 8900</li>
                        <li><i class="fas fa-envelope"></i> support@shopeasy.com</li>
                        <li><i class="fas fa-clock"></i> Mon-Sun: 9:00 AM - 10:00 PM</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 ShopEasy. All rights reserved.</p>
                <div class="payment-methods">
                    <i class="fab fa-cc-visa"></i>
                    <i class="fab fa-cc-mastercard"></i>
                    <i class="fab fa-cc-paypal"></i>
                    <i class="fab fa-cc-apple-pay"></i>
                    <i class="fab fa-cc-amazon-pay"></i>
                </div>
            </div>
        </div>
    </footer>

    <!-- Back to Top -->
    <button class="back-to-top" id="backToTop">
        <i class="fas fa-chevron-up"></i>
    </button>

    <!-- JavaScript -->
    <script src="../js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Load cart items into checkout
            loadCheckoutItems();
            
            // Initialize checkout functionality
            initCheckout();
        });

        function loadCheckoutItems() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const orderItemsContainer = document.getElementById('orderItems');
            let subtotal = 0;
            
            if (cart.length === 0) {
                orderItemsContainer.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--gray-color);">
                        <i class="fas fa-shopping-cart" style="font-size: 40px; margin-bottom: 15px;"></i>
                        <p>Your cart is empty</p>
                        <a href="products.html" class="btn btn-primary btn-sm">Continue Shopping</a>
                    </div>
                `;
                updateCheckoutSummary(0);
                document.getElementById('placeOrderBtn').disabled = true;
                return;
            }
            
            let itemsHTML = '';
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                
                itemsHTML += `
                    <div class="order-item">
                        <img src="${item.image}" alt="${item.name}" class="order-item-image">
                        <div class="order-item-details">
                            <div class="order-item-name">${item.name}</div>
                            <div class="order-item-quantity">Qty: ${item.quantity}</div>
                        </div>
                        <div class="order-item-price">$${itemTotal.toFixed(2)}</div>
                    </div>
                `;
            });
            
            orderItemsContainer.innerHTML = itemsHTML;
            updateCheckoutSummary(subtotal);
            document.getElementById('placeOrderBtn').disabled = false;
        }

        function updateCheckoutSummary(subtotal) {
            const shipping = parseFloat(document.getElementById('checkoutShipping').textContent.replace('$', ''));
            const tax = subtotal * 0.08; // 8% tax
            const total = subtotal + shipping + tax;
            
            document.getElementById('checkoutSubtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('checkoutTax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('checkoutTotal').textContent = `$${total.toFixed(2)}`;
        }

        function initCheckout() {
            // Shipping Method Selection
            const shippingMethods = document.querySelectorAll('.shipping-method');
            shippingMethods.forEach(method => {
                method.addEventListener('click', function() {
                    // Remove selected class from all shipping methods
                    shippingMethods.forEach(m => {
                        m.classList.remove('selected');
                        m.querySelector('input[type="radio"]').checked = false;
                    });
                    
                    // Add selected class to clicked method
                    this.classList.add('selected');
                    this.querySelector('input[type="radio"]').checked = true;
                    
                    // Update shipping cost
                    const shippingType = this.dataset.method;
                    updateShippingCost(shippingType);
                });
            });

            // Payment Method Selection
            const paymentMethods = document.querySelectorAll('.payment-method');
            const paymentForms = document.querySelectorAll('.payment-form');
            
            paymentMethods.forEach(method => {
                method.addEventListener('click', function() {
                    // Remove selected class from all payment methods
                    paymentMethods.forEach(m => {
                        m.classList.remove('selected');
                        m.querySelector('input[type="radio"]').checked = false;
                    });
                    
                    // Hide all payment forms
                    paymentForms.forEach(form => {
                        form.classList.remove('active');
                        form.style.display = 'none';
                    });
                    
                    // Add selected class to clicked method
                    this.classList.add('selected');
                    this.querySelector('input[type="radio"]').checked = true;
                    
                    // Show corresponding payment form
                    const paymentType = this.dataset.method;
                    const formId = `${paymentType}-form`;
                    const form = document.getElementById(formId);
                    if (form) {
                        form.style.display = 'block';
                        form.classList.add('active');
                    }
                });
            });

            // Format card number input
            const cardNumberInput = document.getElementById('card-number');
            if (cardNumberInput) {
                cardNumberInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
                    let formatted = '';
                    
                    for (let i = 0; i < value.length; i++) {
                        if (i > 0 && i % 4 === 0) {
                            formatted += ' ';
                        }
                        formatted += value[i];
                    }
                    
                    e.target.value = formatted.substring(0, 19);
                });
            }

            // Format expiry date input
            const expiryInput = document.getElementById('expiry-date');
            if (expiryInput) {
                expiryInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
                    
                    if (value.length >= 2) {
                        value = value.substring(0, 2) + '/' + value.substring(2, 4);
                    }
                    
                    e.target.value = value.substring(0, 5);
                });
            }

           // Place Order Button
const placeOrderBtn = document.getElementById('placeOrderBtn');
if (placeOrderBtn) {
    placeOrderBtn.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Validate form before proceeding
        const isValid = validateForm();
        
        if (!isValid) {
            // Show error message
            showValidationError("Please fill in all required fields correctly");
            return;
        }
        
        // Show loading
        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
        this.disabled = true;
        
        // Simulate order processing
        setTimeout(() => {
            const orderData = collectOrderData();
            localStorage.setItem('lastOrder', JSON.stringify(orderData));
            
            // Clear cart
            localStorage.removeItem('cart');
            
            // Generate order ID
            const orderId = 'ORD-' + Date.now();
            document.getElementById('orderIdDisplay').textContent = orderId;
            
            // Show celebration popup
            showCelebrationPopup();
            
            // Create confetti effect
            createConfetti();
            
        }, 2000);
    });
}

// Enhanced Form Validation
function validateForm() {
    let isValid = true;
    
    // Clear all previous errors first
    clearAllErrors();
    
    // Check required fields
    const requiredFields = [
        'firstName', 'lastName', 'email', 'phone', 'address',
        'city', 'state', 'zipCode', 'country'
    ];
    
    requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field && !field.value.trim()) {
            showFieldError(field, 'This field is required');
            isValid = false;
        }
    });
    
    // Validate email format
    const emailField = document.getElementById('email');
    if (emailField && emailField.value.trim()) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(emailField.value.trim())) {
            showFieldError(emailField, 'Please enter a valid email address');
            isValid = false;
        }
    }
    
    // Validate phone number
    const phoneField = document.getElementById('phone');
    if (phoneField && phoneField.value.trim()) {
        const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
        const phoneDigits = phoneField.value.replace(/\D/g, '');
        if (!phoneRegex.test(phoneDigits) || phoneDigits.length < 10) {
            showFieldError(phoneField, 'Please enter a valid phone number');
            isValid = false;
        }
    }
    
    // Validate card details if credit card is selected
    const creditCardSelected = document.getElementById('credit-card').checked;
    if (creditCardSelected) {
        const cardFields = ['card-number', 'card-name', 'expiry-date', 'cvv'];
        
        cardFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field && !field.value.trim()) {
                showFieldError(field, 'This field is required');
                isValid = false;
            }
        });
        
        // Validate card number
        const cardNumberField = document.getElementById('card-number');
        if (cardNumberField && cardNumberField.value.trim()) {
            const cardNumber = cardNumberField.value.replace(/\s/g, '');
            if (cardNumber.length < 16 || !/^\d+$/.test(cardNumber)) {
                showFieldError(cardNumberField, 'Please enter a valid 16-digit card number');
                isValid = false;
            }
        }
        
        // Validate expiry date
        const expiryField = document.getElementById('expiry-date');
        if (expiryField && expiryField.value.trim()) {
            const expiryRegex = /^(0[1-9]|1[0-2])\/?([0-9]{2})$/;
            if (!expiryRegex.test(expiryField.value.trim())) {
                showFieldError(expiryField, 'Please enter a valid expiry date (MM/YY)');
                isValid = false;
            }
        }
        
        // Validate CVV
        const cvvField = document.getElementById('cvv');
        if (cvvField && cvvField.value.trim()) {
            const cvv = cvvField.value.trim();
            if (!/^\d{3,4}$/.test(cvv)) {
                showFieldError(cvvField, 'Please enter a valid 3 or 4 digit CVV');
                isValid = false;
            }
        }
    }
    
    // Check if cart is empty
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    if (cart.length === 0) {
        showValidationError("Your cart is empty! Add items to your cart before checking out.");
        isValid = false;
    }
    
    // Check terms agreement
    const agreeTerms = document.getElementById('agreeTerms');
    if (!agreeTerms.checked) {
        showValidationError("Please agree to the Terms & Conditions");
        isValid = false;
    }
    
    // Scroll to first error if validation failed
    if (!isValid) {
        scrollToFirstError();
    }
    
    return isValid;
}

// Error Display Functions
function showFieldError(field, message) {
    // Add error class to field
    field.classList.add('error');
    
    // Create or update error message
    let errorDiv = field.nextElementSibling;
    if (!errorDiv || !errorDiv.classList.contains('form-error')) {
        errorDiv = document.createElement('div');
        errorDiv.className = 'form-error';
        field.parentNode.insertBefore(errorDiv, field.nextSibling);
    }
    
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';
    errorDiv.style.color = 'var(--danger-color)';
    errorDiv.style.fontSize = '14px';
    errorDiv.style.marginTop = '5px';
}

function showValidationError(message) {
    // Create toast notification
    const toast = document.createElement('div');
    toast.className = 'validation-toast';
    toast.innerHTML = `
        <div class="toast-content">
            <i class="fas fa-exclamation-circle"></i>
            <span>${message}</span>
        </div>
    `;
    
    // Add styles for toast
    toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: var(--danger-color);
        color: white;
        padding: 15px 20px;
        border-radius: var(--border-radius);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 10000;
        animation: slideIn 0.3s ease;
        max-width: 400px;
    `;
    
    document.body.appendChild(toast);
    
    // Remove toast after 5 seconds
    setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
            document.body.removeChild(toast);
        }, 300);
    }, 5000);
    
    // Add toast styles
    if (!document.querySelector('#toast-styles')) {
        const style = document.createElement('style');
        style.id = 'toast-styles';
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
            
            .validation-toast .toast-content {
                display: flex;
                align-items: center;
                gap: 10px;
            }
            
            .validation-toast i {
                font-size: 20px;
            }
        `;
        document.head.appendChild(style);
    }
}

function clearAllErrors() {
    // Remove error classes from all fields
    const errorFields = document.querySelectorAll('.form-control.error');
    errorFields.forEach(field => {
        field.classList.remove('error');
    });
    
    // Hide all error messages
    const errorMessages = document.querySelectorAll('.form-error');
    errorMessages.forEach(msg => {
        msg.style.display = 'none';
    });
}

function scrollToFirstError() {
    const firstError = document.querySelector('.form-control.error');
    if (firstError) {
        firstError.scrollIntoView({
            behavior: 'smooth',
            block: 'center'
        });
        
        // Add focus to first error field
        firstError.focus();
    }
}

// Add real-time validation
document.addEventListener('DOMContentLoaded', function() {
    // Add input event listeners for real-time validation
    const formFields = document.querySelectorAll('.form-control');
    formFields.forEach(field => {
        field.addEventListener('input', function() {
            if (this.classList.contains('error')) {
                this.classList.remove('error');
                const errorDiv = this.nextElementSibling;
                if (errorDiv && errorDiv.classList.contains('form-error')) {
                    errorDiv.style.display = 'none';
                }
            }
        });
        
        // Add blur validation for immediate feedback
        field.addEventListener('blur', function() {
            validateField(this);
        });
    });
    
    // Validate individual field
    function validateField(field) {
        const fieldId = field.id;
        
        switch(fieldId) {
            case 'email':
                if (field.value.trim() && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(field.value.trim())) {
                    showFieldError(field, 'Please enter a valid email address');
                }
                break;
                
            case 'phone':
                if (field.value.trim()) {
                    const phoneDigits = field.value.replace(/\D/g, '');
                    if (phoneDigits.length < 10) {
                        showFieldError(field, 'Phone number must be at least 10 digits');
                    }
                }
                break;
                
            case 'card-number':
                if (field.value.trim() && document.getElementById('credit-card').checked) {
                    const cardNumber = field.value.replace(/\s/g, '');
                    if (cardNumber.length < 16 || !/^\d+$/.test(cardNumber)) {
                        showFieldError(field, 'Please enter a valid 16-digit card number');
                    }
                }
                break;
                
            case 'expiry-date':
                if (field.value.trim() && document.getElementById('credit-card').checked) {
                    if (!/^(0[1-9]|1[0-2])\/?([0-9]{2})$/.test(field.value.trim())) {
                        showFieldError(field, 'Please enter a valid expiry date (MM/YY)');
                    }
                }
                break;
                
            case 'cvv':
                if (field.value.trim() && document.getElementById('credit-card').checked) {
                    if (!/^\d{3,4}$/.test(field.value.trim())) {
                        showFieldError(field, 'Please enter a valid 3 or 4 digit CVV');
                    }
                }
                break;
        }
    }
});

            // Apply Coupon Button
            const applyCouponBtn = document.querySelector('.btn-apply-coupon');
            if (applyCouponBtn) {
                applyCouponBtn.addEventListener('click', function() {
                    const couponCode = document.getElementById('couponCode').value;
                    if (couponCode) {
                        applyCoupon(couponCode);
                    }
                });
            }

            // PayPal Redirect Button
            const paypalRedirectBtn = document.getElementById('paypal-redirect');
            if (paypalRedirectBtn) {
                paypalRedirectBtn.addEventListener('click', function() {
                    alert('You would be redirected to PayPal for payment. This is a demo.');
                });
            }
        }

        function updateShippingCost(shippingType) {
            let shippingCost = 9.99;
            
            switch(shippingType) {
                case 'express':
                    shippingCost = 19.99;
                    break;
                case 'overnight':
                    shippingCost = 29.99;
                    break;
            }
            
            // Update the shipping cost display
            const shippingElement = document.getElementById('checkoutShipping');
            if (shippingElement) {
                shippingElement.textContent = `$${shippingCost.toFixed(2)}`;
                
                // Recalculate total
                const subtotal = parseFloat(document.getElementById('checkoutSubtotal').textContent.replace('$', '')) || 0;
                updateCheckoutSummary(subtotal);
            }
        }

        function validateForm() {
            let isValid = true;
            
            // Check required fields
            const requiredFields = [
                'firstName', 'lastName', 'email', 'phone', 'address',
                'city', 'state', 'zipCode', 'country'
            ];
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field && !field.value.trim()) {
                    showError(field, 'This field is required');
                    isValid = false;
                } else {
                    clearError(field);
                }
            });
            
            // Validate email
            const emailField = document.getElementById('email');
            if (emailField && emailField.value) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(emailField.value)) {
                    showError(emailField, 'Please enter a valid email address');
                    isValid = false;
                }
            }
            
            // Validate card details if credit card is selected
            const creditCardSelected = document.getElementById('credit-card').checked;
            if (creditCardSelected) {
                const cardFields = ['card-number', 'card-name', 'expiry-date', 'cvv'];
                cardFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field && !field.value.trim()) {
                        showError(field, 'This field is required');
                        isValid = false;
                    } else {
                        clearError(field);
                    }
                });
                
                // Validate card number (basic check)
                const cardNumber = document.getElementById('card-number');
                if (cardNumber && cardNumber.value.replace(/\s/g, '').length < 16) {
                    showError(cardNumber, 'Please enter a valid card number');
                    isValid = false;
                }
            }
            
            // Check terms agreement
            const agreeTerms = document.getElementById('agreeTerms');
            if (!agreeTerms.checked) {
                alert('Please agree to the Terms & Conditions');
                isValid = false;
            }
            
            return isValid;
        }

        function showError(field, message) {
            field.classList.add('error');
            const errorDiv = field.nextElementSibling;
            if (errorDiv && errorDiv.classList.contains('form-error')) {
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
            }
        }

        function clearError(field) {
            field.classList.remove('error');
            const errorDiv = field.nextElementSibling;
            if (errorDiv && errorDiv.classList.contains('form-error')) {
                errorDiv.style.display = 'none';
            }
        }

        function applyCoupon(code) {
            // Simulate coupon validation
            const validCoupons = {
                'SAVE10': 0.10,
                'WELCOME20': 0.20,
                'FREESHIP': 'free-shipping'
            };
            
            if (validCoupons[code.toUpperCase()]) {
                alert(`Coupon "${code}" applied successfully!`);
                // In a real app, you would update the prices here
            } else {
                alert('Invalid coupon code');
            }
        }

        function collectOrderData() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const subtotal = parseFloat(document.getElementById('checkoutSubtotal').textContent.replace('$', '')) || 0;
            const shipping = parseFloat(document.getElementById('checkoutShipping').textContent.replace('$', '')) || 0;
            const tax = parseFloat(document.getElementById('checkoutTax').textContent.replace('$', '')) || 0;
            const total = parseFloat(document.getElementById('checkoutTotal').textContent.replace('$', '')) || 0;
            
            return {
                orderId: 'ORD-' + Date.now(),
                items: cart,
                subtotal: subtotal,
                shipping: shipping,
                tax: tax,
                total: total,
                shippingMethod: document.querySelector('.shipping-method.selected')?.dataset.method || 'standard',
                paymentMethod: document.querySelector('.payment-method.selected')?.dataset.method || 'credit-card',
                customerInfo: {
                    firstName: document.getElementById('firstName').value,
                    lastName: document.getElementById('lastName').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    address: document.getElementById('address').value,
                    city: document.getElementById('city').value,
                    state: document.getElementById('state').value,
                    zipCode: document.getElementById('zipCode').value,
                    country: document.getElementById('country').value
                },
                timestamp: new Date().toISOString()
            };
        }

        function showCelebrationPopup() {
    const popup = document.getElementById('celebrationPopup');
    if (popup) {
        popup.classList.add('active');
        document.body.style.overflow = 'hidden'; // Prevent scrolling
    }
}

function closeCelebrationPopup() {
    const popup = document.getElementById('celebrationPopup');
    if (popup) {
        popup.classList.remove('active');
        document.body.style.overflow = 'auto'; // Re-enable scrolling
        
        // Redirect to home page after closing
        setTimeout(() => {
            window.location.href = '../index.html';
        }, 300);
    }
}

function createConfetti() {
    const colors = [
        '#FF5252', '#FF4081', '#E040FB', '#7C4DFF', 
        '#536DFE', '#448AFF', '#40C4FF', '#18FFFF',
        '#64FFDA', '#69F0AE', '#B2FF59', '#EEFF41',
        '#FFFF00', '#FFD740', '#FFAB40', '#FF6E40'
    ];
    
    const confettiCount = 150;
    
    for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        
        // Random position
        const left = Math.random() * 100;
        const animationDelay = Math.random() * 2;
        const animationDuration = 2 + Math.random() * 2;
        const size = 5 + Math.random() * 10;
        
        // Random color
        const color = colors[Math.floor(Math.random() * colors.length)];
        
        // Set styles
        confetti.style.left = `${left}vw`;
        confetti.style.width = `${size}px`;
        confetti.style.height = `${size}px`;
        confetti.style.backgroundColor = color;
        confetti.style.animationDelay = `${animationDelay}s`;
        confetti.style.animationDuration = `${animationDuration}s`;
        
        // Random shape
        if (Math.random() > 0.5) {
            confetti.style.borderRadius = '50%';
        }
        
        // Add to popup
        document.getElementById('celebrationPopup').appendChild(confetti);
        
        // Remove confetti after animation
        setTimeout(() => {
            confetti.remove();
        }, (animationDelay + animationDuration) * 1000);
    }
}

// Close popup on outside click
document.getElementById('celebrationPopup')?.addEventListener('click', function(e) {
    if (e.target === this) {
        closeCelebrationPopup();
    }
});

// Close popup with Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeCelebrationPopup();
    }
});

// Country-State-City Data
const countryData = {
    'US': {
        name: 'United States',
        states: {
            'NY': { name: 'New York', cities: ['New York City', 'Buffalo', 'Rochester', 'Albany', 'Syracuse'] },
            'CA': { name: 'California', cities: ['Los Angeles', 'San Francisco', 'San Diego', 'Sacramento', 'San Jose'] },
            'TX': { name: 'Texas', cities: ['Houston', 'Dallas', 'Austin', 'San Antonio', 'Fort Worth'] },
            'FL': { name: 'Florida', cities: ['Miami', 'Orlando', 'Tampa', 'Jacksonville', 'Tallahassee'] },
            'IL': { name: 'Illinois', cities: ['Chicago', 'Springfield', 'Aurora', 'Naperville', 'Peoria'] }
        }
    },
    'IN': {
        name: 'India',
        states: {
            'MH': { name: 'Maharashtra', cities: ['Mumbai', 'Pune', 'Nagpur', 'Nashik', 'Aurangabad'] },
            'DL': { name: 'Delhi', cities: ['New Delhi', 'Delhi'] },
            'KA': { name: 'Karnataka', cities: ['Bangalore', 'Mysore', 'Hubli', 'Mangalore', 'Belgaum'] },
            'TN': { name: 'Tamil Nadu', cities: ['Chennai', 'Coimbatore', 'Madurai', 'Trichy', 'Salem'] },
            'GJ': { name: 'Gujarat', cities: ['Ahmedabad', 'Surat', 'Vadodara', 'Rajkot', 'Bhavnagar'] },
            'RJ': { name: 'Rajasthan', cities: ['Jaipur', 'Jodhpur', 'Udaipur', 'Kota', 'Ajmer'] }
        }
    },
    'CA': {
        name: 'Canada',
        states: {
            'ON': { name: 'Ontario', cities: ['Toronto', 'Ottawa', 'Mississauga', 'Hamilton', 'London'] },
            'QC': { name: 'Quebec', cities: ['Montreal', 'Quebec City', 'Laval', 'Gatineau', 'Longueuil'] },
            'BC': { name: 'British Columbia', cities: ['Vancouver', 'Victoria', 'Surrey', 'Burnaby', 'Richmond'] }
        }
    },
    'UK': {
        name: 'United Kingdom',
        states: {
            'ENG': { name: 'England', cities: ['London', 'Manchester', 'Birmingham', 'Liverpool', 'Leeds'] },
            'SCT': { name: 'Scotland', cities: ['Edinburgh', 'Glasgow', 'Aberdeen', 'Dundee', 'Inverness'] },
            'WLS': { name: 'Wales', cities: ['Cardiff', 'Swansea', 'Newport', 'Bangor', 'St Davids'] }
        }
    },
    'AU': {
        name: 'Australia',
        states: {
            'NSW': { name: 'New South Wales', cities: ['Sydney', 'Newcastle', 'Wollongong', 'Central Coast', 'Albury'] },
            'VIC': { name: 'Victoria', cities: ['Melbourne', 'Geelong', 'Ballarat', 'Bendigo', 'Mildura'] },
            'QLD': { name: 'Queensland', cities: ['Brisbane', 'Gold Coast', 'Cairns', 'Townsville', 'Toowoomba'] }
        }
    }
};

// Function to update states based on selected country
function updateStates() {
    const countrySelect = document.getElementById('country');
    const stateSelect = document.getElementById('state');
    const citySelect = document.getElementById('city');
    const countryCode = countrySelect.value;
    
    // Reset state and city dropdowns
    stateSelect.innerHTML = '<option value="">Select State</option>';
    citySelect.innerHTML = '<option value="">Select City</option>';
    stateSelect.disabled = true;
    citySelect.disabled = true;
    
    if (countryCode && countryData[countryCode]) {
        // Enable state dropdown
        stateSelect.disabled = false;
        
        // Populate states
        const states = countryData[countryCode].states;
        for (const stateCode in states) {
            const option = document.createElement('option');
            option.value = stateCode;
            option.textContent = states[stateCode].name;
            stateSelect.appendChild(option);
        }
    }
    
    // Clear any previous errors
    clearFieldError(stateSelect);
    clearFieldError(citySelect);
}

// Function to update cities based on selected state
function updateCities() {
    const countrySelect = document.getElementById('country');
    const stateSelect = document.getElementById('state');
    const citySelect = document.getElementById('city');
    const countryCode = countrySelect.value;
    const stateCode = stateSelect.value;
    
    // Reset city dropdown
    citySelect.innerHTML = '<option value="">Select City</option>';
    citySelect.disabled = true;
    
    if (countryCode && stateCode && countryData[countryCode] && countryData[countryCode].states[stateCode]) {
        // Enable city dropdown
        citySelect.disabled = false;
        
        // Populate cities
        const cities = countryData[countryCode].states[stateCode].cities;
        cities.forEach(city => {
            const option = document.createElement('option');
            option.value = city;
            option.textContent = city;
            citySelect.appendChild(option);
        });
    }
    
    // Clear any previous errors
    clearFieldError(citySelect);
}

// Helper function to clear field errors
function clearFieldError(field) {
    field.classList.remove('error');
    const errorDiv = field.nextElementSibling;
    if (errorDiv && errorDiv.classList.contains('form-error')) {
        errorDiv.style.display = 'none';
    }
}

// Update validation to handle the new fields
function validateForm() {
    let isValid = true;
    clearAllErrors();
    
    const requiredFields = [
        'firstName', 'lastName', 'email', 'phone', 'address',
        'country', 'state', 'city', 'zipCode'
    ];
    
    requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field && !field.value.trim()) {
            showFieldError(field, 'This field is required');
            isValid = false;
        }
    });
    
    // Validate country-state-city chain
    const country = document.getElementById('country').value;
    const state = document.getElementById('state').value;
    const city = document.getElementById('city').value;
    
    if (country && !state) {
        showFieldError(document.getElementById('state'), 'Please select a state');
        isValid = false;
    }
    
    if (state && !city) {
        showFieldError(document.getElementById('city'), 'Please select a city');
        isValid = false;
    }
    
    // Validate ZIP/Postal Code based on country
    const zipCodeField = document.getElementById('zipCode');
    if (zipCodeField && zipCodeField.value.trim()) {
        const zipCode = zipCodeField.value.trim();
        let isValidZip = true;
        
        switch(country) {
            case 'US':
                // US ZIP code: 5 digits or 5+4
                isValidZip = /^\d{5}(-\d{4})?$/.test(zipCode);
                if (!isValidZip) {
                    showFieldError(zipCodeField, 'Please enter a valid US ZIP code (5 or 9 digits)');
                }
                break;
            case 'IN':
                // Indian PIN code: 6 digits
                isValidZip = /^\d{6}$/.test(zipCode);
                if (!isValidZip) {
                    showFieldError(zipCodeField, 'Please enter a valid Indian PIN code (6 digits)');
                }
                break;
            case 'CA':
                // Canadian postal code: A1A 1A1 format
                isValidZip = /^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/.test(zipCode);
                if (!isValidZip) {
                    showFieldError(zipCodeField, 'Please enter a valid Canadian postal code (A1A 1A1)');
                }
                break;
            case 'UK':
                // UK postcode: Various formats
                isValidZip = /^[A-Z]{1,2}\d[A-Z\d]? ?\d[A-Z]{2}$/i.test(zipCode);
                if (!isValidZip) {
                    showFieldError(zipCodeField, 'Please enter a valid UK postcode');
                }
                break;
            case 'AU':
                // Australian postcode: 4 digits
                isValidZip = /^\d{4}$/.test(zipCode);
                if (!isValidZip) {
                    showFieldError(zipCodeField, 'Please enter a valid Australian postcode (4 digits)');
                }
                break;
        }
        
        if (!isValidZip) {
            isValid = false;
        }
    }
    
    // Rest of your validation code...
    // [Keep your existing validation for email, phone, etc.]
    
    return isValid;
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    // Add change event listeners for country and state
    const countrySelect = document.getElementById('country');
    const stateSelect = document.getElementById('state');
    
    if (countrySelect) {
        countrySelect.addEventListener('change', updateStates);
    }
    
    if (stateSelect) {
        stateSelect.addEventListener('change', updateCities);
    }
    
    // Add real-time ZIP code validation
    const zipCodeField = document.getElementById('zipCode');
    if (zipCodeField) {
        zipCodeField.addEventListener('input', function() {
            validateZipCode(this);
        });
    }
});

// Function to validate ZIP code in real-time
function validateZipCode(field) {
    const country = document.getElementById('country').value;
    const zipCode = field.value.trim();
    
    if (!zipCode || !country) return;
    
    let isValid = true;
    let errorMessage = '';
    
    switch(country) {
        case 'US':
            isValid = /^\d{5}(-\d{4})?$/.test(zipCode);
            errorMessage = 'Enter valid US ZIP (5 or 9 digits)';
            break;
        case 'IN':
            isValid = /^\d{6}$/.test(zipCode);
            errorMessage = 'Enter valid Indian PIN (6 digits)';
            break;
        case 'CA':
            isValid = /^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/.test(zipCode);
            errorMessage = 'Enter valid Canadian postal code (A1A 1A1)';
            break;
        case 'UK':
            isValid = /^[A-Z]{1,2}\d[A-Z\d]? ?\d[A-Z]{2}$/i.test(zipCode);
            errorMessage = 'Enter valid UK postcode';
            break;
        case 'AU':
            isValid = /^\d{4}$/.test(zipCode);
            errorMessage = 'Enter valid Australian postcode (4 digits)';
            break;
    }
    
    if (!isValid && zipCode.length > 0) {
        showFieldError(field, errorMessage);
    } else {
        clearFieldError(field);
    }
}
    </script>
    <!-- Celebration Popup -->
    <div class="celebration-popup" id="celebrationPopup">
     <div class="popup-content">
        <div class="success-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <h2>Order Placed Successfully!</h2>
        <p>Thank you for your purchase! Your order has been confirmed and will be processed shortly.</p>
        <p><strong>Order ID:</strong> <span id="orderIdDisplay">ORD-123456</span></p>
        <p>A confirmation email has been sent to your email address.</p>
        <button class="btn-close-popup" onclick="closeCelebrationPopup()">Continue Shopping</button>
    </div>
</div>
</body>
</html>